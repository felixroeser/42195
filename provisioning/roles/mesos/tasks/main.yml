- name: mesos | install
  command: dpkg --skip-same-version -i /vagrant/pkg/{{ item }}
  register: dpkg_result
  changed_when: "dpkg_result.stdout.startswith('Selecting')"
  with_items: 
    - mesos_0.14.0-rc4_amd64.deb
- name: mesos | zookeeper config
  template: src=zk.j2 dest=/etc/mesos/zk
- name: mesos | ip address
  template: src=ip.j2 dest=/etc/mesos/ip
- name: mesos | cluster name
  template: src=cluster.j2 dest=/etc/mesos/cluster
- lineinfile: 
    dest: /etc/default/mesos
    regexp: ^IP=
    line: IP=`cat /etc/mesos/ip`
- lineinfile: 
    dest: /etc/default/mesos-master
    regexp: ^CLUSTER=
    line: CLUSTER=`cat /etc/mesos/cluster`
  when: master
- name: mesos | wrapper
  template: src=mesos-init-wrapper.j2 dest=/usr/bin/mesos-init-wrapper mode=755
- name: mesos | start master service
  service: name=mesos-master state=started
  when: master
- name: mesos | start slave service
  service: name=mesos-slave state=started
  when: master == false

